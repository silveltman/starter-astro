---
import LayoutPages from '@layouts/LayoutPages.astro'
import { getCollection } from 'astro:content'

export async function getStaticPaths() {
  // Get pages not starting with underscore_
  const pages = await getCollection(
    'pages',
    ({ slug }) => !slug.split('/').pop()?.startsWith('_')
  )


  return pages.map((page) => {
    let pageSlug: string | undefined = page.slug
    if (pageSlug === 'index') {
      pageSlug = undefined
    }

    return {
      params: {
        slug: pageSlug,
      },
      props: { page },
    }
  })
}

const page = Astro.props.page

// Throw error if no content blocks are found
if (!page.data.content_blocks) {
  throw new Error(
    `No content_blocks found`
  )
}
---

<LayoutPages {...page.data} />
